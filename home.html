<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paygo - حجز الفنادق</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      background: #f4f4f4;
    }
    .search-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      margin: 40px auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .form-label {
      font-size: 14px;
      color: #444;
    }
    input, select {
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .suggestions {
      border: 1px solid #ccc;
      max-height: 150px;
      overflow-y: auto;
      background-color: white;
      position: absolute;
      width: 100%;
      top: 105px;
      z-index: 1000;
      border-radius: 5px;
    }
    .suggestions div {
      padding: 10px;
      cursor: pointer;
    }
    .suggestions div:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

<div class="search-box">
  <form id="searchForm">
    <label class="form-label">المدينة</label>
    <input type="text" id="cityInput" class="form-control" placeholder="أدخل المدينة" autocomplete="off" required>
    <div id="suggestions" class="suggestions"></div>

    <label class="form-label">الوصول</label>
    <input type="date" id="checkIn" class="form-control" required>

    <label class="form-label">المغادرة</label>
    <input type="date" id="checkOut" class="form-control" required>

    <button type="submit" class="btn btn-primary w-100 mt-3">ابحث</button>
  </form>
</div>

<script>
  let token = "";
  async function fetchToken() {
    const res = await fetch("https://test.api.amadeus.com/v1/security/oauth2/token", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: "grant_type=client_credentials&client_id=UspRLCHI82AtaL2AsflFSLYxrRh0asMB&client_secret=R1ZGO9tgOA4P5EPJ"
    });
    const data = await res.json();
    token = data.access_token;
  }

  async function fetchCities(query) {
    if (!token) await fetchToken();
    const res = await fetch(`https://test.api.amadeus.com/v1/reference-data/locations?subType=CITY&keyword=${query}`, {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    });
    const data = await res.json();
    return data.data || [];
  }

  const cityInput = document.getElementById("cityInput");
  const suggestionsDiv = document.getElementById("suggestions");

  cityInput.addEventListener("input", async () => {
    const query = cityInput.value;
    if (query.length < 2) {
      suggestionsDiv.innerHTML = "";
      return;
    }
    const results = await fetchCities(query);
    suggestionsDiv.innerHTML = results.map(city => `<div data-code="${city.iataCode}">${city.name}</div>`).join("");
  });

  suggestionsDiv.addEventListener("click", (e) => {
    if (e.target.dataset.code) {
      cityInput.value = e.target.innerText;
      cityInput.setAttribute("data-code", e.target.dataset.code);
      suggestionsDiv.innerHTML = "";
    }
  });

  document.getElementById("searchForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const city = cityInput.getAttribute("data-code");
    const checkIn = document.getElementById("checkIn").value;
    const checkOut = document.getElementById("checkOut").value;

    if (!city || !checkIn || !checkOut) {
      alert("يرجى إدخال جميع البيانات");
      return;
    }

    // توجيه إلى صفحة الفنادق مع البيانات
    window.location.href = `hotels.html?city=${city}&checkIn=${checkIn}&checkOut=${checkOut}`;
  });
</script>

</body>
</html>
