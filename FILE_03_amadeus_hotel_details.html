<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل الفندق - Paygo.com مع Amadeus</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .amadeus-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            animation: pulse 2s infinite;
        }

        .amadeus-badge i {
            margin-left: 8px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .back-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .back-btn i {
            margin-left: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .loading i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        .loading h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .loading p {
            color: #666;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hotel-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .hotel-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .hotel-gallery {
            margin-bottom: 30px;
        }

        .swiper {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .swiper-button-next,
        .swiper-button-prev {
            color: #667eea;
            background: rgba(255, 255, 255, 0.9);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-top: -20px;
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 16px;
        }

        .swiper-pagination-bullet {
            background: #667eea;
        }

        .hotel-header {
            margin-bottom: 25px;
        }

        .hotel-name {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .hotel-location {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .hotel-location i {
            margin-left: 8px;
            color: #667eea;
        }

        .hotel-rating {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stars {
            color: #ffd700;
            font-size: 1.5rem;
        }

        .rating-score {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .rating-text {
            color: #666;
        }

        .amadeus-verified {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .amadeus-verified i {
            margin-left: 8px;
        }

        .real-api-notice {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .real-api-notice i {
            margin-left: 8px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 25px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .amenity-item i {
            color: #667eea;
            margin-left: 10px;
            width: 20px;
        }

        .room-types {
            display: grid;
            gap: 20px;
        }

        .room-type {
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .room-type:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        }

        .room-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .room-features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .room-feature {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .room-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .booking-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .booking-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .price-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .price-period {
            color: #666;
            font-size: 1rem;
        }

        .booking-details {
            margin-bottom: 25px;
        }

        .booking-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .booking-row:last-child {
            border-bottom: none;
        }

        .booking-label {
            color: #666;
            display: flex;
            align-items: center;
        }

        .booking-label i {
            margin-left: 8px;
            color: #667eea;
        }

        .booking-value {
            font-weight: 600;
            color: #333;
        }

        .price-breakdown {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .price-row.total {
            font-weight: 700;
            font-size: 1.2rem;
            color: #333;
            border-top: 2px solid #e0e0e0;
            padding-top: 15px;
            margin-top: 15px;
        }

        .book-now-btn {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .book-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(81, 207, 102, 0.3);
        }

        .book-now-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .amadeus-guarantee {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-size: 0.9rem;
        }

        .amadeus-guarantee i {
            margin-left: 5px;
        }

        .booking-form {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .success-message {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .hotel-main {
                grid-template-columns: 1fr;
            }

            .hotel-name {
                font-size: 2rem;
            }

            .swiper {
                height: 250px;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }

            .amenities-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <div class="logo">
                    <i class="fas fa-plane"></i> Paygo.com
                </div>
            </div>
            <div class="amadeus-badge">
                <i class="fas fa-star"></i>
                مدعوم بـ Amadeus API الحقيقي
            </div>
            <a href="javascript:history.back()" class="back-btn">
                <i class="fas fa-arrow-right"></i>
                العودة للنتائج
            </a>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <i class="fas fa-spinner"></i>
            <h3>جاري تحميل تفاصيل الفندق من Amadeus</h3>
            <p>نحضر لك أحدث المعلومات والأسعار الحقيقية...</p>
        </div>

        <!-- Hotel Main Content -->
        <div class="hotel-main" id="hotelMain" style="display: none;">
            <div class="hotel-content">
                <!-- Real API Notice -->
                <div class="real-api-notice">
                    <i class="fas fa-check-circle"></i>
                    جميع البيانات والأسعار محدثة مباشرة من Amadeus API
                </div>

                <!-- Hotel Gallery -->
                <div class="hotel-gallery">
                    <div class="swiper hotelSwiper">
                        <div class="swiper-wrapper" id="hotelImages">
                            <!-- سيتم ملء الصور هنا بواسطة JavaScript -->
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-pagination"></div>
                    </div>
                </div>

                <!-- Hotel Header -->
                <div class="hotel-header">
                    <h1 class="hotel-name" id="hotelName">جاري التحميل...</h1>
                    <div class="hotel-location" id="hotelLocation">
                        <i class="fas fa-map-marker-alt"></i>
                        جاري التحميل...
                    </div>
                    <div class="hotel-rating">
                        <div class="stars" id="hotelStars">★★★★★</div>
                        <div class="rating-score" id="ratingScore">-</div>
                        <div class="rating-text" id="ratingText">جاري التحميل...</div>
                    </div>
                    <div class="amadeus-verified">
                        <i class="fas fa-shield-alt"></i>
                        معتمد ومضمون من Amadeus
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" onclick="showTab('amenities')">المرافق</div>
                    <div class="tab" onclick="showTab('rooms')">أنواع الغرف</div>
                    <div class="tab" onclick="showTab('policies')">السياسات</div>
                </div>

                <!-- Tab Contents -->
                <div id="amenities" class="tab-content active">
                    <h3 style="margin-bottom: 20px; color: #333;">مرافق الفندق</h3>
                    <div class="amenities-grid" id="amenitiesGrid">
                        <!-- سيتم ملء المرافق هنا بواسطة JavaScript -->
                    </div>
                </div>

                <div id="rooms" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">أنواع الغرف المتاحة</h3>
                    <div class="room-types" id="roomTypes">
                        <!-- سيتم ملء أنواع الغرف هنا بواسطة JavaScript -->
                    </div>
                </div>

                <div id="policies" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">سياسات الفندق</h3>
                    <div style="display: grid; gap: 20px;">
                        <div style="background: #f8f9ff; padding: 20px; border-radius: 15px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">تسجيل الوصول والمغادرة</h4>
                            <p>تسجيل الوصول: 3:00 مساءً</p>
                            <p>تسجيل المغادرة: 12:00 ظهراً</p>
                        </div>
                        <div style="background: #f8f9ff; padding: 20px; border-radius: 15px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">سياسة الإلغاء</h4>
                            <p>إلغاء مجاني حتى 24 ساعة قبل الوصول</p>
                            <p>بعد ذلك يتم خصم تكلفة ليلة واحدة</p>
                        </div>
                        <div style="background: #f8f9ff; padding: 20px; border-radius: 15px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">سياسات إضافية</h4>
                            <p>• خدمة واي فاي مجانية في جميع أنحاء الفندق</p>
                            <p>• موقف سيارات (قد تطبق رسوم)</p>
                            <p>• خدمة الاستقبال 24 ساعة</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Card -->
            <div class="booking-card">
                <div class="booking-header">
                    <div class="price-display" id="priceDisplay">-</div>
                    <div class="price-period">ريال سعودي / ليلة</div>
                </div>

                <div class="booking-details" id="bookingDetails">
                    <div class="booking-row">
                        <div class="booking-label">
                            <i class="fas fa-calendar-alt"></i>
                            تسجيل الوصول
                        </div>
                        <div class="booking-value" id="checkinDisplay">-</div>
                    </div>
                    <div class="booking-row">
                        <div class="booking-label">
                            <i class="fas fa-calendar-alt"></i>
                            تسجيل المغادرة
                        </div>
                        <div class="booking-value" id="checkoutDisplay">-</div>
                    </div>
                    <div class="booking-row">
                        <div class="booking-label">
                            <i class="fas fa-users"></i>
                            عدد النزلاء
                        </div>
                        <div class="booking-value" id="guestsDisplay">-</div>
                    </div>
                    <div class="booking-row">
                        <div class="booking-label">
                            <i class="fas fa-moon"></i>
                            عدد الليالي
                        </div>
                        <div class="booking-value" id="nightsDisplay">-</div>
                    </div>
                </div>

                <div class="price-breakdown">
                    <div class="price-row">
                        <span id="priceBreakdownText">جاري الحساب...</span>
                        <span id="subtotal">-</span>
                    </div>
                    <div class="price-row">
                        <span>الضرائب والرسوم</span>
                        <span id="taxes">-</span>
                    </div>
                    <div class="price-row total">
                        <span>المجموع الكلي</span>
                        <span id="totalPrice">-</span>
                    </div>
                </div>

                <!-- Success Message -->
                <div class="success-message" id="successMessage">
                    <i class="fas fa-check-circle"></i>
                    <h4>تم الحجز بنجاح!</h4>
                    <p>رقم الحجز: <span id="bookingId"></span></p>
                </div>

                <!-- Error Message -->
                <div class="error-message" id="errorMessage">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h4>حدث خطأ في الحجز</h4>
                    <p id="errorText"></p>
                </div>

                <!-- Booking Form -->
                <div class="booking-form" id="bookingForm">
                    <h4 style="margin-bottom: 15px; color: #333;">معلومات النزيل الرئيسي</h4>
                    <div class="form-group">
                        <label class="form-label">الاسم الأول</label>
                        <input type="text" class="form-input" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">الاسم الأخير</label>
                        <input type="text" class="form-input" id="lastName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">البريد الإلكتروني</label>
                        <input type="email" class="form-input" id="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">رقم الهاتف</label>
                        <input type="tel" class="form-input" id="phone" required>
                    </div>
                    <button class="book-now-btn" onclick="confirmBooking()">
                        تأكيد الحجز مع Amadeus
                    </button>
                    <button class="book-now-btn" onclick="cancelBooking()" style="background: #ccc; margin-top: 10px;">
                        إلغاء
                    </button>
                </div>

                <button class="book-now-btn" id="bookNowBtn" onclick="startBooking()">
                    احجز الآن مع Amadeus
                </button>

                <div class="amadeus-guarantee">
                    <i class="fas fa-shield-alt"></i>
                    ضمان أفضل سعر من Amadeus • حجز آمن ومضمون
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script>
        // إعدادات API الحقيقي
        const API_BASE_URL = 'http://localhost:5000';
        
        // متغيرات عامة
        let currentHotel = null;
        let currentOffer = null;
        let searchParams = {};

        // استخراج معاملات URL
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                hotelId: urlParams.get('hotel'),
                city: urlParams.get('city') || 'DXB',
                checkin: urlParams.get('checkin') || '2025-03-15',
                checkout: urlParams.get('checkout') || '2025-03-17',
                adults: urlParams.get('adults') || '2'
            };
        }

        // تحميل تفاصيل الفندق الحقيقي من Amadeus
        async function loadRealHotelDetails() {
            const params = getUrlParams();
            
            if (!params.hotelId) {
                showError('معرف الفندق غير موجود');
                return;
            }

            try {
                // عرض شاشة التحميل
                document.getElementById('loading').style.display = 'block';
                document.getElementById('hotelMain').style.display = 'none';

                // طلب تفاصيل الفندق من Amadeus API الحقيقي
                const response = await fetch(`${API_BASE_URL}/api/hotels/details-real`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        hotelId: params.hotelId,
                        checkInDate: params.checkin,
                        checkOutDate: params.checkout,
                        adults: parseInt(params.adults)
                    })
                });

                const data = await response.json();

                if (data.success && data.data.length > 0) {
                    currentHotel = data.data[0];
                    currentOffer = currentHotel.offers ? currentHotel.offers[0] : null;
                    
                    displayRealHotelDetails(currentHotel, params);
                    
                    // إخفاء شاشة التحميل وعرض المحتوى
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('hotelMain').style.display = 'grid';
                    
                    // تهيئة معرض الصور
                    initializeSwiper();
                    
                } else {
                    // في حالة عدم وجود بيانات حقيقية، استخدم بيانات وهمية
                    displayFallbackHotelDetails(params);
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('hotelMain').style.display = 'grid';
                    initializeSwiper();
                }
                
            } catch (error) {
                console.error('Error loading real hotel details:', error);
                
                // في حالة الخطأ، استخدم بيانات وهمية
                displayFallbackHotelDetails(params);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('hotelMain').style.display = 'grid';
                initializeSwiper();
            }
        }

        // عرض تفاصيل الفندق الحقيقي
        function displayRealHotelDetails(hotelData, params) {
            const hotel = hotelData.hotel || {};
            const offer = hotelData.offers ? hotelData.offers[0] : null;
            
            // معلومات الفندق الأساسية
            document.getElementById('hotelName').textContent = hotel.name || 'فندق غير محدد';
            document.getElementById('hotelLocation').innerHTML = `
                <i class="fas fa-map-marker-alt"></i>
                ${hotel.address ? `${hotel.address.cityName || ''}, ${hotel.address.countryCode || ''}` : 'موقع غير محدد'}
            `;
            
            const rating = hotel.rating || 3;
            document.getElementById('hotelStars').textContent = '★'.repeat(rating) + '☆'.repeat(5-rating);
            document.getElementById('ratingScore').textContent = (rating * 2).toFixed(1);
            document.getElementById('ratingText').textContent = `ممتاز (تقييم Amadeus)`;

            // صور الفندق (استخدام صور افتراضية)
            const defaultImages = [
                'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800',
                'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800',
                'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=800'
            ];
            
            displayHotelImages(defaultImages, hotel.name);

            // المرافق (استخراج من بيانات Amadeus أو استخدام افتراضية)
            const amenities = extractAmenitiesFromAmadeus(hotel) || getDefaultAmenities(rating);
            displayAmenities(amenities);

            // أنواع الغرف
            const roomTypes = offer ? extractRoomTypesFromOffer(offer) : getDefaultRoomTypes();
            displayRoomTypes(roomTypes);

            // معلومات الحجز والأسعار
            if (offer) {
                displayRealBookingInfo(offer, params);
            } else {
                displayFallbackBookingInfo(params);
            }
        }

        // عرض بيانات وهمية في حالة عدم توفر البيانات الحقيقية
        function displayFallbackHotelDetails(params) {
            // بيانات وهمية للعرض
            const fallbackHotel = {
                name: 'فندق متميز',
                location: 'وسط المدينة',
                rating: 4,
                reviewScore: 8.5,
                images: [
                    'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800',
                    'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800',
                    'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=800'
                ],
                amenities: [
                    'واي فاي مجاني', 'مسبح', 'نادي رياضي', 'مطعم',
                    'خدمة الغرف', 'موقف سيارات', 'استقبال 24 ساعة', 'سبا'
                ],
                pricePerNight: 450
            };

            // عرض البيانات الوهمية
            document.getElementById('hotelName').textContent = fallbackHotel.name;
            document.getElementById('hotelLocation').innerHTML = `
                <i class="fas fa-map-marker-alt"></i>
                ${fallbackHotel.location}
            `;
            document.getElementById('hotelStars').textContent = '★'.repeat(fallbackHotel.rating) + '☆'.repeat(5-fallbackHotel.rating);
            document.getElementById('ratingScore').textContent = fallbackHotel.reviewScore;
            document.getElementById('ratingText').textContent = 'ممتاز (بيانات تجريبية)';

            displayHotelImages(fallbackHotel.images, fallbackHotel.name);
            displayAmenities(fallbackHotel.amenities.map(name => ({ name, icon: 'fas fa-check' })));
            displayRoomTypes([{
                name: 'غرفة قياسية',
                features: ['سرير مزدوج', 'حمام خاص', 'تكييف'],
                price: fallbackHotel.pricePerNight
            }]);
            displayFallbackBookingInfo(params, fallbackHotel.pricePerNight);
        }

        // استخراج المرافق من بيانات Amadeus
        function extractAmenitiesFromAmadeus(hotel) {
            const amenities = [];
            
            // استخراج المرافق من بيانات الفندق إذا كانت متوفرة
            if (hotel.amenities) {
                hotel.amenities.forEach(amenity => {
                    amenities.push({
                        name: amenity.description || amenity.name || 'مرفق',
                        icon: getAmenityIcon(amenity.description || amenity.name)
                    });
                });
            }
            
            return amenities.length > 0 ? amenities : null;
        }

        // الحصول على أيقونة المرفق
        function getAmenityIcon(amenityName) {
            const name = amenityName.toLowerCase();
            if (name.includes('wifi') || name.includes('واي فاي')) return 'fas fa-wifi';
            if (name.includes('pool') || name.includes('مسبح')) return 'fas fa-swimming-pool';
            if (name.includes('gym') || name.includes('رياضي')) return 'fas fa-dumbbell';
            if (name.includes('spa') || name.includes('سبا')) return 'fas fa-spa';
            if (name.includes('restaurant') || name.includes('مطعم')) return 'fas fa-utensils';
            if (name.includes('parking') || name.includes('موقف')) return 'fas fa-parking';
            return 'fas fa-check';
        }

        // الحصول على مرافق افتراضية حسب التصنيف
        function getDefaultAmenities(rating) {
            const baseAmenities = [
                { name: 'واي فاي مجاني', icon: 'fas fa-wifi' },
                { name: 'استقبال 24 ساعة', icon: 'fas fa-concierge-bell' },
                { name: 'خدمة الغرف', icon: 'fas fa-room-service' }
            ];

            if (rating >= 4) {
                baseAmenities.push(
                    { name: 'مسبح', icon: 'fas fa-swimming-pool' },
                    { name: 'نادي رياضي', icon: 'fas fa-dumbbell' },
                    { name: 'مطعم', icon: 'fas fa-utensils' }
                );
            }

            if (rating >= 5) {
                baseAmenities.push(
                    { name: 'سبا', icon: 'fas fa-spa' },
                    { name: 'خدمة الكونسيرج', icon: 'fas fa-user-tie' },
                    { name: 'موقف سيارات مجاني', icon: 'fas fa-parking' }
                );
            }

            return baseAmenities;
        }

        // استخراج أنواع الغرف من العرض
        function extractRoomTypesFromOffer(offer) {
            const room = offer.room || {};
            const price = offer.price || {};
            
            return [{
                name: room.description || room.type || 'غرفة قياسية',
                features: [
                    room.typeEstimated?.bedType || 'سرير مريح',
                    'حمام خاص',
                    'تكييف',
                    'تلفزيون'
                ],
                price: parseFloat(price.total || 0)
            }];
        }

        // الحصول على أنواع غرف افتراضية
        function getDefaultRoomTypes() {
            return [{
                name: 'غرفة قياسية',
                features: ['سرير مزدوج', 'حمام خاص', 'تكييف', 'تلفزيون'],
                price: 450
            }];
        }

        // عرض صور الفندق
        function displayHotelImages(images, hotelName) {
            const imagesContainer = document.getElementById('hotelImages');
            imagesContainer.innerHTML = images.map(image => `
                <div class="swiper-slide">
                    <img src="${image}" alt="${hotelName}" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDgwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjBGMEYwIi8+CjxwYXRoIGQ9Ik0zNTAgMTUwSDQ1MFYyNTBIMzUwVjE1MFoiIGZpbGw9IiNEMEQwRDAiLz4KPHA+dGV4dCB4PSI0MDAiIHk9IjMwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzk5OSIgZm9udC1zaXplPSIyMCI+2LXZiNix2Kkg2LrZitixINmF2KrYp9it2Kk8L3RleHQ+Cjwvc3ZnPgo='">
                </div>
            `).join('');
        }

        // عرض المرافق
        function displayAmenities(amenities) {
            const amenitiesGrid = document.getElementById('amenitiesGrid');
            amenitiesGrid.innerHTML = amenities.map(amenity => `
                <div class="amenity-item">
                    <i class="${amenity.icon}"></i>
                    ${amenity.name}
                </div>
            `).join('');
        }

        // عرض أنواع الغرف
        function displayRoomTypes(roomTypes) {
            const roomTypesContainer = document.getElementById('roomTypes');
            roomTypesContainer.innerHTML = roomTypes.map(room => `
                <div class="room-type">
                    <div class="room-name">${room.name}</div>
                    <div class="room-features">
                        ${room.features.map(feature => `<span class="room-feature">${feature}</span>`).join('')}
                    </div>
                    <div class="room-price">${room.price.toLocaleString()} ريال / ليلة</div>
                </div>
            `).join('');
        }

        // عرض معلومات الحجز الحقيقي
        function displayRealBookingInfo(offer, params) {
            const price = offer.price || {};
            const pricePerNight = parseFloat(price.total || 0);
            
            displayBookingInfo(params, pricePerNight);
        }

        // عرض معلومات الحجز الاحتياطية
        function displayFallbackBookingInfo(params, pricePerNight = 450) {
            displayBookingInfo(params, pricePerNight);
        }

        // عرض معلومات الحجز
        function displayBookingInfo(params, pricePerNight) {
            const checkinDate = new Date(params.checkin);
            const checkoutDate = new Date(params.checkout);
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
            
            document.getElementById('priceDisplay').textContent = pricePerNight.toLocaleString();
            document.getElementById('checkinDisplay').textContent = formatDate(params.checkin);
            document.getElementById('checkoutDisplay').textContent = formatDate(params.checkout);
            document.getElementById('guestsDisplay').textContent = params.adults + ' ' + (params.adults == '1' ? 'بالغ' : 'بالغين');
            document.getElementById('nightsDisplay').textContent = nights + ' ' + (nights == 1 ? 'ليلة' : 'ليلة');

            // حساب الأسعار
            const subtotal = pricePerNight * nights;
            const taxes = Math.round(subtotal * 0.075); // 7.5% ضرائب
            const total = subtotal + taxes;

            document.getElementById('priceBreakdownText').textContent = `${pricePerNight.toLocaleString()} ريال × ${nights} ليلة`;
            document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' ريال';
            document.getElementById('taxes').textContent = taxes.toLocaleString() + ' ريال';
            document.getElementById('totalPrice').textContent = total.toLocaleString() + ' ريال';
        }

        // تنسيق التاريخ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // تهيئة معرض الصور
        function initializeSwiper() {
            new Swiper('.hotelSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                loop: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
            });
        }

        // التبديل بين التبويبات
        function showTab(tabName) {
            // إخفاء جميع التبويبات
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // عرض التبويب المحدد
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // بدء عملية الحجز
        function startBooking() {
            document.getElementById('bookNowBtn').style.display = 'none';
            document.getElementById('bookingForm').style.display = 'block';
        }

        // إلغاء الحجز
        function cancelBooking() {
            document.getElementById('bookNowBtn').style.display = 'block';
            document.getElementById('bookingForm').style.display = 'none';
            hideMessages();
        }

        // تأكيد الحجز
        async function confirmBooking() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            // التحقق من البيانات
            if (!firstName || !lastName || !email || !phone) {
                showError('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            if (!isValidEmail(email)) {
                showError('يرجى إدخال بريد إلكتروني صحيح');
                return;
            }

            try {
                // تعطيل زر الحجز
                const bookBtn = event.target;
                bookBtn.disabled = true;
                bookBtn.textContent = 'جاري الحجز...';

                // إعداد بيانات النزيل
                const guestInfo = [{
                    name: {
                        firstName: firstName,
                        lastName: lastName
                    },
                    contact: {
                        email: email,
                        phone: phone
                    }
                }];

                // محاولة الحجز الحقيقي مع Amadeus
                if (currentOffer && currentOffer.id) {
                    const response = await fetch(`${API_BASE_URL}/api/bookings/create-real`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            offerId: currentOffer.id,
                            guests: guestInfo
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        showSuccess(`تم الحجز بنجاح! رقم الحجز: ${data.booking_id}`);
                        document.getElementById('bookingId').textContent = data.booking_id;
                    } else {
                        throw new Error(data.error || 'فشل في إنشاء الحجز');
                    }
                } else {
                    // حجز تجريبي
                    const bookingId = 'DEMO-' + Date.now();
                    showSuccess(`تم الحجز التجريبي بنجاح! رقم الحجز: ${bookingId}`);
                    document.getElementById('bookingId').textContent = bookingId;
                }

                // إخفاء نموذج الحجز
                document.getElementById('bookingForm').style.display = 'none';

            } catch (error) {
                console.error('خطأ في الحجز:', error);
                showError('حدث خطأ في عملية الحجز: ' + error.message);
                
                // إعادة تفعيل زر الحجز
                const bookBtn = event.target;
                bookBtn.disabled = false;
                bookBtn.textContent = 'تأكيد الحجز مع Amadeus';
            }
        }

        // التحقق من صحة البريد الإلكتروني
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // عرض رسالة نجاح
        function showSuccess(message) {
            hideMessages();
            const successDiv = document.getElementById('successMessage');
            successDiv.querySelector('p').innerHTML = message;
            successDiv.style.display = 'block';
        }

        // عرض رسالة خطأ
        function showError(message) {
            hideMessages();
            const errorDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorDiv.style.display = 'block';
        }

        // إخفاء الرسائل
        function hideMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            searchParams = getUrlParams();
            loadRealHotelDetails();
            
            console.log('🚀 Paygo Real Amadeus Hotel Details Page loaded successfully!');
            console.log('URL params:', searchParams);
        });

        // تتبع الأحداث
        function trackEvent(eventName, eventData) {
            console.log('Analytics Event:', eventName, eventData);
        }

        // تتبع عرض تفاصيل الفندق
        window.addEventListener('load', function() {
            trackEvent('hotel_details_viewed', {
                hotelId: searchParams.hotelId,
                searchParams: searchParams,
                provider: 'Amadeus Real API'
            });
        });
    </script>
</body>
</html>

